<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>‚ö° Smart Energy Bill Calculator (Offline)</title>
  <style>
    body {font-family: 'Segoe UI', sans-serif; margin: 20px; background: #0d1117; color: #f0f6fc;}
    h3 {color: #58a6ff;}
    .card {background: #161b22; padding: 16px; border-radius: 10px; margin-bottom: 12px;}
    .primary {background: #238636; border: none; color: white; padding: 8px 14px; border-radius: 8px; cursor: pointer;}
    .danger {background: #da3633; border: none; color: white; padding: 8px 14px; border-radius: 8px; cursor: pointer;}
    select, input {padding: 6px; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: #f0f6fc;}
    .badge {background:#30363d; padding:4px 8px; border-radius:6px;}
    .tips {background:#21262d; padding:8px; border-radius:8px; font-size:14px;}
    .msg-bot {background:#21262d; padding:8px; border-radius:8px; margin:4px 0;}
    #aiSection {position:fixed; bottom:20px; right:20px; width:300px; background:#161b22; padding:12px; border-radius:12px; display:none;}
    #aiInput {width:80%; padding:6px; border-radius:8px; border:1px solid #30363d;}
  </style>
</head>
<body>

<h2>‚ö° Smart Energy Bill Calculator (Offline)</h2>

<label id="lblLang">Language</label>
<select id="selLang">
  <option value="en">English</option>
  <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
  <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
  <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
  <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
  <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
  <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
  <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
  <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
  <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
</select>

<label id="lblRegion">Region</label>
<select id="selRegion">
  <option value="ap">Andhra Pradesh</option>
  <option value="tg">Telangana</option>
  <option value="tn">Tamil Nadu</option>
  <option value="mh">Maharashtra</option>
  <option value="ka">Karnataka</option>
  <option value="kl">Kerala</option>
  <option value="gj">Gujarat</option>
  <option value="dl">Delhi</option>
  <option value="wb">West Bengal</option>
  <option value="generic">Generic India</option>
</select>

<div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
  <div class="badge" id="langBadge">EN</div>
  <button id="openAI" class="primary">Assistant</button>
</div>

<br>

<button id="btnAdd" class="primary">+ Add Appliance</button>
<button id="btnCalculate" class="primary">Calculate</button>
<button id="btnReset" class="danger">Reset</button>

<div class="card">
  <h3 id="applianceTitle">Appliance-wise Energy & Cost</h3>
  <div id="applianceList"></div>
</div>

<div class="card">
  <h3 id="summaryTitle">üí° Summary & Suggestions</h3>
  <div id="summaryBox"></div>
  <div id="suggestBox" style="margin-top:8px;"></div>
  <div id="tipsBox" class="tips"></div>
</div>

<!-- Awareness -->
<div style="display:flex; align-items:center; gap:10px; margin-top:12px;">
  <img src="https://cdn-icons-png.flaticon.com/512/2913/2913465.png" width="50" alt="save"/>
  <div>
    <div style="font-weight:700">Save Electricity ‚Äî Save Earth</div>
    <div class="small">Turn off unused devices and prefer energy-efficient appliances.</div>
  </div>
</div>

<!-- AI Chat Section -->
<div id="aiSection">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div id="aiTitle">Energy Assistant</div>
    <div style="cursor:pointer;" id="aiClose">‚úñ</div>
  </div>
  <div class="msg-bot" id="aiWelcome">Hello ‚Äî ask me about tariff slabs, energy saving, or your bill calculation.</div>
  <input id="aiInput" placeholder="Ask (e.g. 'What are Telangana slabs?')" />
  <button id="aiSend" class="primary">Send</button>
</div>

<script>
let appliances = [];

const slabs = {
  generic: [50, 125, 250],
  ap: [50, 100, 200, 400],
  tg: [50, 100, 200, 400],
  tn: [100, 200, 500],
  mh: [100, 300, 500],
  ka: [50, 100, 200, 400],
  kl: [50, 100, 250],
  gj: [50, 100, 250],
  dl: [100, 200, 400],
  wb: [75, 150, 300]
};

function addAppliance() {
  const id = Date.now();
  const div = document.createElement('div');
  div.innerHTML = `
    <input id="name${id}" placeholder="Appliance name" />
    <input id="watt${id}" type="number" placeholder="Watts" />
    <input id="hrs${id}" type="number" placeholder="Hours/day" />
    <input id="days${id}" type="number" placeholder="Days/month" />
    <button onclick="removeAppliance(${id})" class="danger">X</button>
  `;
  document.getElementById('applianceList').appendChild(div);
}

function removeAppliance(id){
  const el = document.getElementById(`name${id}`)?.parentElement;
  if (el) el.remove();
}

function calculateBill() {
  let totalUnits = 0;
  appliances = [];
  document.querySelectorAll('#applianceList > div').forEach(div => {
    const id = div.querySelector('input').id.replace('name','');
    const watts = parseFloat(document.getElementById('watt'+id).value) || 0;
    const hrs = parseFloat(document.getElementById('hrs'+id).value) || 0;
    const days = parseFloat(document.getElementById('days'+id).value) || 0;
    const units = (watts * hrs * days) / 1000;
    totalUnits += units;
    appliances.push({name: document.getElementById('name'+id).value || "Appliance", units});
  });

  const region = document.getElementById('selRegion').value;
  const regionSlabs = slabs[region] || slabs.generic;
  const estBill = totalUnits * 4.43; // base avg rate

  let crossed = 0;
  for(let s of regionSlabs){ if(totalUnits > s) crossed++; }

  let summary = `<b>Total Monthly Units:</b> ${totalUnits.toFixed(2)}<br>
  <b>Estimated Bill:</b> ‚Çπ${estBill.toFixed(2)}<br>`;

  if(crossed > 1) {
    summary += `‚ö° You‚Äôve crossed <b>${crossed} slabs</b> (up to ${regionSlabs[crossed-1]} units).<br>`;
  } else {
    summary += `‚úÖ You‚Äôre within a safe usage slab.<br>`;
  }

  document.getElementById('summaryBox').innerHTML = summary;

  let suggestHTML = "";
  if (crossed >= 2) {
    const prevSlab = regionSlabs[crossed - 1];
    const diffUnits = (totalUnits - prevSlab).toFixed(1);
    const reducedBill = (prevSlab * 4.43).toFixed(2);
    suggestHTML += `
      <b>To reduce to ‚â§ ${prevSlab} units:</b><br>
      ‚Ä¢ Reduce Refrigerator usage by 2 hrs/day to save ~${(diffUnits*0.6).toFixed(1)} units.<br>
      ‚Ä¢ Reduce Water Heater usage by 0.5 hrs/day to save ~${(diffUnits*0.3).toFixed(1)} units.<br>
      ‚Ä¢ Reduce Fan or Light usage by 1 hr/day to save ~${(diffUnits*0.1).toFixed(1)} units.<br>
      üí∞ <b>New Bill ‚âà ‚Çπ${reducedBill}</b><br><br>
    `;
  }
  if (crossed >= 3) {
    const prevSlab2 = slabs[region][crossed - 2];
    const reducedBill2 = (prevSlab2 * 4.43).toFixed(2);
    suggestHTML += `
      <b>To reduce to ‚â§ ${prevSlab2} units:</b><br>
      ‚Ä¢ Cut Water Heater usage by 1 hr/day.<br>
      ‚Ä¢ Use energy-efficient fans and bulbs.<br>
      üí∞ <b>New Bill ‚âà ‚Çπ${reducedBill2}</b>
    `;
  }

  document.getElementById('suggestBox').innerHTML = suggestHTML;
  document.getElementById('tipsBox').innerHTML = "üí° Tip: Try switching to LED bulbs, and use timers for water heaters to avoid unnecessary usage.";
}

document.getElementById('btnAdd').onclick = addAppliance;
document.getElementById('btnCalculate').onclick = calculateBill;
document.getElementById('btnReset').onclick = ()=>location.reload();

document.getElementById('openAI').onclick = ()=>document.getElementById('aiSection').style.display='block';
document.getElementById('aiClose').onclick = ()=>document.getElementById('aiSection').style.display='none';
document.getElementById('aiSend').onclick = ()=>{
  const q = document.getElementById('aiInput').value.toLowerCase();
  const ansBox = document.getElementById('aiWelcome');
  if(q.includes('slab')) ansBox.innerHTML = "Tariff slabs vary by region ‚Äî e.g. Telangana: 0-50, 51-100, 101-200, 200+. Each higher slab has increased rate.";
  else if(q.includes('save')) ansBox.innerHTML = "Switch off idle appliances, use LED lights, avoid standby power, and optimize AC/heater usage.";
  else if(q.includes('bill')) ansBox.innerHTML = "Your bill depends on total kWh consumed per month, multiplied by regional tariff rates and slabs.";
  else ansBox.innerHTML = "I'm your Energy Assistant ‚Äî ask about slabs, savings, or bill calculation.";
};
</script>

</body>
</html>
