<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Smart Energy Bill Calculator ‚ö°</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: "Poppins", sans-serif;
  margin: 0;
  background: linear-gradient(135deg, #90f7ec, #32ccbc);
  color: #222;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

header {
  text-align: center;
  padding: 30px 10px;
  color: #fff;
}
header h1 {
  margin: 0;
  font-size: 32px;
  text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
}
header p { margin-top: 8px; font-size: 15px; }

.container {
  max-width: 900px;
  margin: 20px auto 50px;
  background: rgba(255,255,255,0.95);
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  backdrop-filter: blur(10px);
}

.device-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 12px;
  align-items: center;
  transition: 0.3s;
}
.device-row:hover { background: #f8fcff; border-radius: 12px; }

.device-row select, .device-row input {
  padding: 10px;
  font-size: 15px;
  border: 1px solid #ddd;
  border-radius: 10px;
  flex: 1;
  transition: 0.25s;
  background: #fff;
}
.device-row input:focus, .device-row select:focus {
  border-color: #00bcd4;
  box-shadow: 0 0 6px #99f1ff;
}

button {
  padding: 10px 16px;
  font-size: 15px;
  cursor: pointer;
  border: none;
  border-radius: 10px;
  transition: all 0.3s ease;
  color: white;
}
button:hover { transform: scale(1.05); }
#addDevice { background:#28a745; }
#calculate { background:#007bff; }
#reset { background:#ff4757; }
.remove-btn { background:#fcecec; color:#333; border:1px solid #ffb0b0; }

.cards {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px;
  margin-top: 25px;
}
.card {
  background:#fff;
  border-radius:16px;
  padding:18px;
  box-shadow:0 5px 20px rgba(0,0,0,0.1);
  transition:0.3s;
}
.card:hover { transform:translateY(-5px); }

h3 { color:#007bff; }
.suggestions h4 { color:#00bcd4; }

.controls {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:16px;
}

.awareness {
  margin-top: 30px;
  background: linear-gradient(90deg, #fafff6, #e8ffe9);
  padding: 16px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 15px;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}
.awareness img { width: 60px; height: 60px; }
.awareness p {
  margin: 0;
  font-weight: 500;
  color: #1a7f1a;
}

input:disabled, select:disabled { background: #f4f4f4; }

@media(max-width:700px) {
  .cards { grid-template-columns:1fr; }
  header h1 { font-size: 26px; }
}
</style>
</head>

<body>
<header>
  <h1>‚ö° Smart Energy Bill Calculator</h1>
  <p>Estimate your energy usage & get saving tips instantly üå±</p>
</header>

<div class="container">
  <p><strong>Tip:</strong> Choose an appliance from the list <em>or</em> type your own. Enter daily usage hours and click Calculate.</p>

  <div id="devices"></div>

  <div class="controls">
    <button id="addDevice">+ Add Appliance</button>
    <button id="calculate">Calculate</button>
    <button id="reset">Reset</button>
  </div>

  <div class="cards" id="resultsArea" style="display:none;">
    <div class="card" id="deviceDetails">
      <h3>üìä Appliance-wise Energy & Cost</h3>
      <div id="deviceList"></div>
    </div>
    <div class="card" id="summary">
      <h3>üí° Summary & Suggestions</h3>
      <div id="summaryContent"></div>
      <div class="suggestions" id="suggestions"></div>
    </div>
  </div>

  <div class="awareness">
    <img src="https://cdn-icons-png.flaticon.com/512/1161/1161793.png" alt="Save">
    <p>‚ö†Ô∏è Switch off fans, lights, and TVs when not in use ‚Äî save power, save earth üåç</p>
  </div>
</div>

<script>
// ---------- Appliance wattages ----------
const applianceWatts = {
  "Fan": 75,
  "Tube Light": 40,
  "LED Bulb": 10,
  "Air Conditioner": 1200,
  "Refrigerator": 150,
  "Laptop": 60,
  "TV": 120,
  "Washing Machine": 500,
  "Microwave": 1000,
  "Iron": 800,
  "Water Heater": 1500
};

// ---------- Keyword-based watt estimation ----------
function estimateWatts(name) {
  name = name.toLowerCase();
  if (name.includes("ac") || name.includes("air")) return 1200;
  if (name.includes("heater") || name.includes("geyser")) return 1500;
  if (name.includes("fan")) return 75;
  if (name.includes("light") || name.includes("bulb")) return 15;
  if (name.includes("tv")) return 120;
  if (name.includes("computer") || name.includes("laptop")) return 60;
  if (name.includes("iron")) return 800;
  if (name.includes("pump")) return 500;
  if (name.includes("fridge") || name.includes("refrigerator")) return 150;
  if (name.includes("oven") || name.includes("microwave")) return 1000;
  if (name.includes("machine")) return 500;
  return 150; // fallback realistic default
}

// ---------- Electricity slab calculation ----------
function calculateBill(units) {
  const slabs = [
    [30, 1.90],
    [45, 3.00],
    [50, 4.50],
    [100, 6.00],
    [175, 8.75],
    [Infinity, 9.75]
  ];
  let total = 0, remaining = units;
  for (const [limit, rate] of slabs) {
    const use = Math.min(remaining, limit);
    total += use * rate;
    remaining -= use;
    if (remaining <= 0) break;
  }
  return total;
}

// ---------- Slab limits ----------
const slabLimits = [30, 75, 125, 225, 400];

// ---------- Suggest reduction ----------
function suggestReductions(devices, totalUnits, targetUnits) {
  let excess = totalUnits - targetUnits;
  if (excess <= 0) return ["‚úÖ Already within target!"];
  const sorted = devices.slice().sort((a, b) => ((b.power*b.hrs) - (a.power*a.hrs)));
  const suggestions = [];
  for (const d of sorted) {
    if (excess <= 0) break;
    const monthlyUnits = (d.power / 1000) * d.hrs * 30;
    const reduce = Math.min(monthlyUnits, excess);
    const newHrs = ((monthlyUnits - reduce) / (d.power / 1000)) / 30;
    suggestions.push(`Reduce <b>${d.name}</b> usage to <b>${newHrs.toFixed(1)} hrs/day</b> to save ~${reduce.toFixed(1)} units.`);
    excess -= reduce;
  }
  return suggestions;
}

// ---------- Generate slab insights ----------
function generateSlabSuggestions(devices, totalUnits) {
  const crossed = slabLimits.filter(limit => totalUnits > limit);
  let html = "";
  if (crossed.length === 0) {
    html += `<p>üëè Excellent! You‚Äôre within the lowest consumption slab.</p>`;
  } else {
    html += `<p>‚ö° You‚Äôve crossed <b>${crossed.length}</b> slabs (up to ${crossed.at(-1)} units).</p>`;
    crossed.reverse().forEach(slab => {
      const tips = suggestReductions(devices, totalUnits, slab);
      const newBill = calculateBill(slab);
      html += `
        <h4>To reduce to ‚â§ ${slab} units:</h4>
        <ul>${tips.map(t => `<li>${t}</li>`).join('')}</ul>
        <p><em>üí∞ New Bill ‚âà ‚Çπ${newBill.toFixed(2)}</em></p>
      `;
    });
  }
  return html;
}

// ---------- UI Handling ----------
const devicesDiv = document.getElementById('devices');
const addBtn = document.getElementById('addDevice');
const calcBtn = document.getElementById('calculate');
const resetBtn = document.getElementById('reset');
const resultsArea = document.getElementById('resultsArea');

// Create device input row
function createDeviceRow(selected='') {
  const row = document.createElement('div');
  row.className = 'device-row';
  let options = `<option value="">Select Appliance</option>`;
  for (const app in applianceWatts) {
    options += `<option value="${app}">${app}</option>`;
  }
  row.innerHTML = `
    <select class="dev-name">${options}</select>
    <input type="text" placeholder="Or type appliance name" class="dev-custom" />
    <input type="number" placeholder="Power (W)" class="dev-power" step="any">
    <input type="number" placeholder="Hours/day" class="dev-hrs" step="any">
    <button class="remove-btn">‚úñ</button>
  `;
  const select = row.querySelector('.dev-name');
  const custom = row.querySelector('.dev-custom');
  const powerInput = row.querySelector('.dev-power');
  const remove = row.querySelector('.remove-btn');

  remove.addEventListener('click', () => row.remove());

  // Dropdown change
  select.addEventListener('change', () => {
    if (select.value) {
      custom.disabled = true;
      powerInput.value = applianceWatts[select.value];
    } else {
      custom.disabled = false;
      powerInput.value = '';
    }
  });

  // Manual entry handling
  custom.addEventListener('input', () => {
    if (custom.value.trim()) {
      select.disabled = true;
      powerInput.value = estimateWatts(custom.value);
    } else {
      select.disabled = false;
      powerInput.value = '';
    }
  });

  devicesDiv.appendChild(row);
}

addBtn.addEventListener('click', () => createDeviceRow());
resetBtn.addEventListener('click', () => { devicesDiv.innerHTML=''; resultsArea.style.display='none'; });

// Calculation
calcBtn.addEventListener('click', () => {
  const rows = devicesDiv.querySelectorAll('.device-row');
  if (rows.length === 0) return alert("Add at least one appliance.");

  const devices = Array.from(rows).map(r => {
    const select = r.querySelector('.dev-name');
    const custom = r.querySelector('.dev-custom');
    const power = parseFloat(r.querySelector('.dev-power').value) || 0;
    const hrs = parseFloat(r.querySelector('.dev-hrs').value) || 0;
    const name = select.disabled ? custom.value : (select.value || "Unnamed Device");
    return { name, power, hrs };
  });

  let totalUnits = 0;
  let html = "";
  devices.forEach(d => {
    const units = (d.power / 1000) * d.hrs * 30;
    totalUnits += units;
    const cost = calculateBill(units);
    html += `<div><b>${d.name}</b>: ${units.toFixed(2)} units | ‚Çπ${cost.toFixed(2)}</div>`;
  });

  const totalCost = calculateBill(totalUnits);
  document.getElementById('deviceList').innerHTML = html;
  document.getElementById('summaryContent').innerHTML = `
    <p><b>Total Monthly Units:</b> ${totalUnits.toFixed(2)}</p>
    <p><b>Estimated Bill:</b> ‚Çπ${totalCost.toFixed(2)}</p>
  `;
  document.getElementById('suggestions').innerHTML = generateSlabSuggestions(devices, totalUnits);
  resultsArea.style.display = 'grid';
});

// Initial row
createDeviceRow();
</script>
</body>
</html>
